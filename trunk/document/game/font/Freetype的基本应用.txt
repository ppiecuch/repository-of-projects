最近要给引擎加入字体支持了，上网找了下，发现freetype不错，就搞下来玩了下，发现效果还真是不错。由于是基本应用，不涉及字体变形什么的，只是一些调调间距，改变颜色，让字符好看些的技术

1, 得到字符的正确绘制位置

首先在创建好FTFace，Freetype推荐使用基线作为绘制基准，但是通常都是设置字符左上角的位置开始绘制。需要获得基线到字符轮廓最高点的距离，这个信息放在

Ascender = FTFace->size->metrics.ascender  >> 6;    // 基线到字符轮廓最高点的距离, 由于是26.6的定点数，因此获取整数部分需要除以64

然后每个字符的高度是不同的，Freetype生成的bitmap一般刚刚好包围到字符，比如a和l的bitmap图高度是不同的。因此还需要获得每个字符的偏移宽度和高度，这两个信息放在

bitmap_left = FTFace->glyph->bitmap_left;  // 字符距离左边界的距离

bitmap_top = FTFace->glyph->bitmap_top; // 字符最高点距离基线的距离

好了，现在假设要在(posx, posy)处绘制字符，(charposx, charposy)表示字符的正确绘制位置

charposx = posx + bitmap_left;

charposy = posy + Ascender - bitmap_top;

2，行距

字符轮廓最大高度放在

FTFace->size->metrics.height         // 字符轮廓最大高度, 26.6定点数

但是我实测发现，这个高度太高了点，所以我一般是这样用的

Descender = FTFace->size->metrics.descender >> 6;  // // 基线到字符轮廓最低点的距离

FontHeight  = ((FTFace->size->metrics.height >> 6) + Ascender + Descender) / 2;

然后还可以在FontHeight上加上一个固定高度，比如1或2

3，字符颜色

Freetype生成的图是8bit灰度图(也有别的，不过8bit好看些)，文字部分为白色，背景为黑色。

这就有个麻烦，一般字体都是黑的，那好如果把字体颜色取反，就黑的变白的，白的变黑的了。

可是呢，要加上颜色怎么办？这就是Freetype的文字是白色的原因，因为是8bit灰度图，因此不是黑色或白色的地方，颜色就成了一个比例因子，只需将其与想要设置的颜色相乘再除以256即可，比如灰度图中某点的颜色是156，想要设置的颜色是RGB(127, 42, 186)，那么实际的颜色是

(127 * 156 >> 8, 42 * 156 >> 8, 186 * 156 >> 8)

回到之前说的，如果将黑的变白的，白的变黑的，那么比例因子就要再取反一次，麻烦了。

而且，如果字体被设置过颜色后，灰度图的比例因子效果就丧失了，不能再被设置成其他颜色了(重新获取灰度图就要花多余的时间了)。

解决方法是，把8bit灰度图保存在alpha通道中。如果想设置颜色就从alpha通道中获取灰度值即可。

4，把字符变的好看些

上面把灰度图保存在alpha通道中了，如果你的驱动支持alpha混合，那么恭喜你了，字符能和背景混合。

不错，灰度图还兼有alpha功能，如果想好看些就做alpha混合吧。

我的驱动不支持alpha混合，只好自己混合了。

5，字间距调整

只要不是等宽字体，都需要字间距调整，google下 FreeType 2开发文档 [中译版] 吧，有详细介绍。

我照着做成功了的。



本文来自CSDN博客，转载请标明出处：http://blog.csdn.net/rikpan/archive/2009/02/07/3867961.aspx