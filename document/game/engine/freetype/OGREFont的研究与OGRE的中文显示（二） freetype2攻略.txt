文字是人类文化最重要的组成部分

作为改变人类的IT行业，对文字的数字化、信息化的研究更是从未停止过。

如果你不知道Digital Typography，至少听说过true type或unicode这些词汇吧？

前者是一种文字技术，而后者则是一种文字编码。当然现在有一些更新的东东，如Clear type和UTF。

建议大家可以先去了解一下这些背景知识。

 

若论应用最多最广的文字技术，那么肯定是true type了，true type是Apple在1991年第一次推出的，

应用于当时的system7操作系统。然后MS取得了授权，并重写了光栅化程序，在1992年的windows3.1

中开始使用。为什么引入true tpye？之前的系统用什么显示文字呢？

没错，你猜对了，在true type之前，每个字都要对应一个位图（现在有的游戏也还在用），等一下，

不光是每个字，是每个字的每种格式和尺寸（也就是说，一个‘我’字从12号到20号字需要不同的

图形）。对于那个时期的硬件来说，这种做法是不能接受也没有前途的。那么true type的原理是什么呢？

简单来说，就是制作字体的人需要先将字体的上一些重要的点存储起来，在显示的时候根据不同的尺寸

和格式的要求再用这些点生成目标文字。所以true type文字是向量的，也就是说，只需要一套字体，

你就可以生成N个大小的文字。

制作一个truetype字库，对于英语这样由有限个字母组成的文字来说，只需要制作字母＋标点就可以了。

但是对于中文、日文、韩文这些语言，由于文字非常多（基本上会用到的汉字有2.2万个），所以制作一个

truetype字库所需要的时间和人力会成百倍的增长。你可以打开Windows的Font目录看看，一般英文字库

也就是2、3百K，而中文的至少要2、3M。还记得方正告暴雪字库侵权的事吗？其实我是挺能理解方正的。

制作字库的苦差事我们就不管了，下面开始介绍怎样显示TTF字库。我们的主角freetype2登场了。

 

Debian、Ubuntu、GTK、Qt、OGRE......这些软件都是用freetype2作为font service，如果你手头有个PSP

游戏机或是Nokia的手机，那么你也在使用freetype。不是我搞个人崇拜，对于freetype的创始人David Turner

我只能说，我对你的景仰，犹如滔滔江水。。。。。。

我崇拜的是他能够坚持10几年将开源的freetype发扬光大。就算后来他去Google了freetype也在继续。

 

freetype的使用是非常简单的，我这里就不具体介绍了，大家可以去freetype.org学习一下。

下面我会介绍一些需要注意的地方和我的一点心得。

我花了3天时间写了一个DEMO，如下图



 

这个例子使用freetype2.3.7，根据设定的格式将输入的文字生成一个texture image，为真正的应用做准备。

上面是使用宋体生成竖排，从右至左阅读，右上对其的“早发白帝城”。文字大小是18px。

1). 大家可以注意一下右上角的message，看到了吧，simsun一共有22141个Glyph。

2). 每个EM的单位数量是256个，我看了simhei也是256，但一般的英文字库都是2048（都是2的n次方）。多说一句，所谓的EM

就是一个假象的方块，在这个方块内绘制文字的Glyph，（但是文字也可能超过EM的边界）。它的计量单位

是Font unit，在使用freetype的时候，这个font unit、26.6格式、point大小和pixel大小要搞清楚哦。

自然，每个EM的单位数量越多，制作字体的时候就可以越精确。但真正的输出结果却还和其他很多因素有关。

大家可以去看看，微软雅黑每个EM的单位数量是2048，这个字库在小尺寸的文字显示上效果还是不错的。

3). 2 char maps，这个是文字编码与Glyph之间的对应关系，一般的TTF字库都有2个char map，一个是unicode，一个是Apple

用的Macintosh Roman。我们一般都用unicode。

4). fixed size，这个是我这次做DEMO比较重要的一个发现。之前看到很多人抱怨freetype输出20px以下的小字体效果较差，

那么看看下面这个12px的“早发白帝城”怎么样



 

（格式中加了下划线）没错，这个12px是simsun的fxisize，所以效果和可读性非常好。这在freetype中也叫bitmap strike。

5). underline position是文字的下划线位置，注意，单位是font unit。

 

（未完待续）。。。。。。

（2008年9月11日）

上次写了一半，这几天把DEMO又完善了一下，加上了字体加粗(Bold)和斜体(Italic)，又看了很多这方面的资料，感觉头大。

其实还想好好继续研究下去，可是项目的时间来不及了。我自己的字体类已经有了雏形，用在这个项目里应该足够了。

如果以后有时间，再回来好好研究。下面就继续再聊聊freetype。

使用freetype显示一个文字的步骤大致是这样：

1. 打开字库文件（以truetype为例 *.ttf/*.ttc）；

2. 打开字库中的某个font face；

3. 得到文字与Glyph对应关系的charmap；

4. 根据文字的unicode编码和charmap获取文字Glyph；

5. Grid-fitting（或Hinting）；

6. Render

7. 其他操作。。。。

8. 关闭

这里面我想说说hinting，好的hinting算法对于小尺寸文字的清晰度与可读性是至关重要的。

一个文字大概的形状通过Glyph是定义好的，但是根据尺寸缩放后显示出来的效果怎么样，hinting是最重要的一步。

一个好的hinting算法可以达到点阵字体的效果，如果hinting很糟糕的话，那么文字基本上就没法看了。

truetype针对hinting专门有opcode，也就是说在ttf文件中不光存着文字的glyph信息，还有一些用于hinting的代码

如处理‘m’glyph的时候，它的三条腿应该一样宽，如‘I’和‘T’中的竖扛应该一样宽，等等。

处理这些，需要一个解释器bytecode interpreter，遗憾的是，Apple对它拥有专利，所以使用时是需要付费的。

对于freetype1.x，所有使用的freetype的用户都需要付费给Apple。

好在freetype2.x已经不受这个限制了，因为它新增了auto-hinting模块。我记得看到David Turner说过，制作

auto-hinting模块是一件非常费时费力的工作，需要一点点去调整和优化。可喜的是，现在的auto-hinting与

anti-aliasing结合生成的文字已经足以媲美使用bytecode interpreter的结果了。

其实hinting并没有一个“最好”的结果，需要在所有的因素之间妥协，找到一个最佳的妥协点就好了。

 

最后送给大家一副小篆字体生成的“早发白帝城”，老祖宗留下来的东西还需要大家来发扬光大啊！

 



 

下篇文章是本系列的重点，题目暂定“ODText OGRE实战”

敬请期待

 

/*********************************************************************************/

/* 以下内容专做讨论用

/* Pic added Jly, 23 2010 to illustrate a ClearType effect

/*



/*********************************************************************************/

 

分享到： 
上一篇：OGREFont的研究与OGRE的中文显示（一）引言
下一篇：OGREFont的研究与OGRE的中文显示（三）小插曲

查看评论
35楼 beyondjjw 2010-11-05 16:38发表 [回复]

楼主能不能不用bitmap画字体呢，使用outline,纯粹的画outline，怎么做呢
34楼 CDUT_binb_N_man 2010-10-28 11:45发表 [回复]

现在公司一个项目需要用到freetype，问一下使用freetype2需要付费吗？
33楼 lanmu01 2010-09-17 11:03发表 [回复]

有您上面说的tinting color的资料么？
我现在宋体用的是点阵，就是MONO，结果转斜体和做描边的时候对它都无效了~
32楼 lanmu01 2010-07-14 20:56发表 [回复]

hello，又是我，你这里有没有freetype发光的例子？
Re: superjoel 2010-07-15 17:06发表 [回复]

回复 lanmu01：抱歉，没有。那个有成熟的算法，你可以用freetype将glyph生成内存图片，然后应用描边、发光这些算法。
Re: lanmu01 2010-07-19 17:17发表 [回复]

回复 superjoel：我现在是先描边，然后用高斯模糊把边给弄模糊，算是发光效果了。但是想宋体用MONO模式的话就没有outline了。。。
Re: superjoel 2010-07-19 17:24发表 [回复]

回复 lanmu01：既然要描边，就别用mono了。感觉要描边的话字体20px以上会比较好一些，太小了也不好看。
Re: lanmu01 2010-07-19 20:19发表 [回复]

回复 superjoel：试过win7下的freetype么？ win7默认支持cleartype的，没有cleartype的很难看，但是freetype不能用cleartype，很郁闷啊
Re: superjoel 2010-07-20 09:12发表 [回复]

回复 lanmu01：没在win7下试过，freetype是跨平台的C语言包，显示效果应该不会有太大差别。win7下你可以试试微软雅黑字体。
Re: lanmu01 2010-07-21 17:33发表 [回复]

回复 superjoel：对的，你看win7下的雅黑在开cleartype和不开cleartype的情况下有些字差别比较大，比如“常”。freetype画出来就是不开cleartype的那样子，很是难看。
Re: superjoel 2010-07-23 13:54发表 [回复]

回复 lanmu01：Clear Type是MS专用的，依靠ClearType技术提高字体的可读性，相当程度上依赖于使用的字体，所以和freetype的抗锯齿技术不能进行单纯比较。但是我感觉在取得glyph后可以在render时做一些工作来模拟clear type的效果。特意找出来以前的一个截图，见本文最后更新的部分。右上角那首竖排、右上对其的词在render时使用了tinting color（render使用directx9）。字库用的是黑体，算是有些Clear Type的效果。如果这个效果你还算满意的话，建议你在render时再多做些工作。
31楼 匿名用户 2010-07-09 19:17发表 [回复]

autohint用起来宋体的西文字很模糊，我已经找到加粗的方法了，对于Mono模式来说 要用FT_Bitmap_Embolden来加粗，但是斜体还没搞定。。。
30楼 superjoel 2010-07-09 16:46发表 [回复]

我不记得有这么多参数，为什么不用autohint呢？（ FT_LOAD_NO_AUTOHINT）。抱歉我这里没法用MSN或QQ。
29楼 lanmu01 2010-07-08 16:25发表 [回复]

方便的话，给我一个您的联系方式吧MSN，QQ之类的，我好和您交流下
28楼 lanmu01 2010-07-08 15:58发表 [回复]

我用Arial替换宋体的西文字了，宋体的中文粗体你画出来是什么样的？
27楼 lanmu01 2010-07-08 14:18发表 [回复]

我现在的宋体是用这些标志画的：flags = FT_LOAD_IGNORE_GLOBAL_ADVANCE_WIDTH | FT_LOAD_MONOCHROME | FT_LOAD_CROP_BITMAP | FT_LOAD_NO_AUTOHINT | FT_LOAD_TARGET_MONO
renderMode = FT_RENDER_MODE_MONO
画出来就是很难看
26楼 lanmu01 2010-07-08 11:06发表 [回复]

没办法，我只能找别的渲染方法了，另外我想问下你的baseline和underline是怎么定位的？
25楼 lanmu01 2010-07-01 17:22发表 [回复]

苦等了你这么多天你还是不现身啊，，，[e06]
Re: superjoel 2010-07-02 12:05发表 [回复]

回复 lanmu01：抱歉，前段时间在国外出差，刚回来不到一周。字体大小肯定会有差别的，你需要依据baseline和ascender等参数render时把它们对齐。部分代码请参见后面的一篇blog。
Re: lanmu01 2010-07-05 10:57发表 [回复]

回复 superjoel：（接上面，好像一次回复字数有限制。。）然后通过设置hint模式为FT_LOAD_NO_AUTOHINT，anti-aliasing为FT_LOAD_TARGET_MONO，rendermode为FT_RENDER_MODE_MONO的情况下，西文字看起来基本和gdi一样，但是粗体显示的时候基本已经没法看了。我不知道是不是和我alpha混合时做的操作有关系，如果你的宋体显示的西文字看起来效果很好的话，请告诉我是如何做的~多谢多谢~
Re: superjoel 2010-07-06 19:30发表 [回复]

回复 lanmu01：我一直是使用autohint加anti-aliasing的，宋体bitmap-strike那几个大小使用我提到的bold方法效果会差些。但也不至于没法看。
Re: lanmu01 2010-07-06 22:04发表 [回复]

回复 superjoel：能否分享一下你demo的源码，我看了你后面blog的部分源码，还是看不出个所以然。多谢！lanmu01@163.com
Re: superjoel 2010-07-08 08:56发表 [回复]

回复 lanmu01：我特意找出了老程序，做了个宋体12px，英文加数字的截图，你的效果是这样吗？

宋体的ASCII字符是没有bitmap strike的，你需要auto hinting，anti-aliasing用于渲染glyph时的抗锯齿。
Re: lanmu01 2010-07-06 21:58发表 [回复]

回复 superjoel：请问你的anti-aliasing是指什么？
Re: lanmu01 2010-07-05 10:56发表 [回复]

回复 superjoel：多谢！后面一片blog我看过了，基本是freetype的一些常规应用，宋体的话用点阵字看起来效果不错的，但是宋体粗体看起来就很抱歉了。我记得你的宋体用的也是FT_LOAD_MONOCHROME标志，用这个标志的情况下中文字看起来效果和GDI基本一样，很清晰，英文字比较模糊
24楼 lanmu01 2010-06-22 20:15发表 [回复]

你好，我也在研究freetype2,当字体很小的时候，我发现字体的大小变得不一样了，而你的小字体看起来很正常，是为什么呢？能否将你的代码分享一下？谢谢
lanmu01@163.com
23楼 匿名用户 2010-04-13 11:34发表 [回复]

你好，想请问如何设置 粗体 斜体 还有下划线。还有能发下你Demo的代码给我学习哈么，不胜感激。我的邮箱是 cane_ni@qq.com 
QQ：57014970
22楼 zbhunter 2010-03-03 22:10发表 [回复]

代码在哪里啊，大大
21楼 superjoel 2010-01-28 19:11发表 [回复]

楼上台湾的TX，代码和说明请看后面的博客
20楼 匿名用户 2010-01-28 14:30发表 [回复]

侵鳎Demoa可以o我一份幔感x感x！！我研究半天是有c}~~~g903107@alumni.nthu.edu.tw
19楼 superjoel 2010-01-11 19:55发表 [回复]

下划线是自己画的。
很多图片都被CSDN审核了，不知为什么[e07]
18楼 ypb362148418 2010-01-07 19:39发表 [回复]

图看不到，不知道为什么，博主给解决一下
17楼 yuyunliuhen 2010-01-07 17:26发表 [回复]

你好，我想问你，你的下划线是怎么做的？
16楼 superjoel 2009-12-18 09:26发表 [回复]

不会啊，请看上面12px的截图
代码请看后面文章
15楼 hwc09230 2009-12-15 23:19发表 [回复]

看楼主文章获益匪浅，不过freetype2生成单色的24pixel以下字体都不怎么好看，小弟进来在研究freetype2，遇到一些问题，希望能看DEMO源码，非常感谢！
邮件是：hwc09230@yahoo.com.cn
14楼 ljtjs 2009-11-07 13:37发表 [回复]

楼主，能否共享你的DEMO源码呢，非常感谢！！ljt_555@163.com
13楼 eplaylity 2009-11-03 23:22发表 [回复]

大哥，你很有演讲天赋~~佩服啊~~~
12楼 superjoel 2009-08-11 12:53发表 [回复]

参考我5月7日的回复：“
我是显示的时候对space,/t,/n等字符做特殊处理，一般space的长度取字符'A'的长度即可。我读过其它开源软件的代码，如果char map里找不到该字符，一般会显示一个小位图出来。如果你用过firefox可能会注意到这个现象。”
11楼 a445363200 2009-08-09 20:20发表 [回复]

不好意思，打错，是输出的图片空格不见了。
10楼 a445363200 2009-08-09 20:20发表 [回复]

楼主，我想请问一下，我不知道为什么输入' '（包含空格）的字符串，但是转化出来以后，字符串就不见了，不知道为什么，可以请教一下吗？
9楼 superjoel 2009-06-25 10:39发表 [回复]

我会整理一下代码，在博客里公布
8楼 jaryhjz 2009-06-24 11:07发表 [回复]

您好，文章中的DEMO源码能否共享一下，劳驾了，不甚感激。jaryhjz@gamil.com
7楼 dengcb179 2009-06-24 10:20发表 [回复]

你好，能发一份给我吗？我也在研究ft2，但是字体总是不太漂亮，谢谢！！邮箱：dengcb179@sina.com
6楼 andrewshen 2009-06-14 22:48发表 [回复]

Hi Joel,能不能给我发一份啊：） 我也想研究一下
我的邮箱是:sechowall@yahoo.com.cn
5楼 superjoel 2009-05-07 09:19发表 [回复]

我是显示的时候对space,/t,/n等字符做特殊处理，一般space的长度取字符'A'的长度即可。我读过其它开源软件的代码，如果char map里找不到该字符，一般会显示一个小位图出来。如果你用过firefox可能会注意到这个现象。
4楼 LouisTien 2009-04-24 11:36发表 [回复]

您好！拜读您的上述文章，我实在获益良多，我最近也在接触Free Type，发现一个问题，那就是我的空白字元(space, 0x20)，一直显示不出来，我看了一下软件内容，发现if ( Glyph_Index == 0 ) Glyph_Index = FT_Get_Char_Index( Face, 0x20);似乎它利用空白来处理Glyph_Index == 0的情况，也因此空白一直显示不出来！看到您上述的文章，发现您的空白是可以正常显示的，可以请教您一下空白的显示方式吗？感激不尽！
3楼 nvng 2009-04-19 01:35发表 [回复]

Hi Joel Gao, I am very interested in FT2. Could you give me a copy of your demo( source code )? My Email address is cn_20080808@126.com. Thanks in advance.
2楼 superjoel 2008-09-20 09:35发表 [回复]

没有特殊的设置，就是设定字体大小为某一个fixsize， Render的时候使用MONO格式就可以了。
另外，18号以下的小字体如果使用灰阶，即使加上anti-aliasing效果也很一般。
1楼 flashboy15 2008-09-18 14:20发表 [回复] [引用] [举报]

高手, 我也在被freetype2, 不太懂freetype2的中文使用方法, 小字体不知道你是怎么设置的,怎么那个漂亮?
希望可以跟你请教一下, 我是做游戏客户端的程序员,我的邮箱: flashboy_15@hotmail.com, QQ: 88104725

http://blog.csdn.net/superjoel/article/details/2899119